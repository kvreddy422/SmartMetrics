<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="">
      <meta name="author" content="">
      <title>IOT Dashboard</title>
      <!-- Bootstrap Core CSS -->
      <link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
      <!-- MetisMenu CSS -->
      <link href="../bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">
      <!-- Custom CSS -->
      <link href="../dist/css/sb-admin-2.css" rel="stylesheet">
      <!-- Custom Fonts -->
      <link rel="icon" href="../dist/img/favicon.ico">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	  <![endif]-->
	  
 
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> 
		<script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>

    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
		
		<style type="text/css">
${demo.css}
		</style> 
      <style>
         #wrapper {
         width: 100%;
         background: white;
         }   
         .mydropdown {
         font-size: 14px!important;
         font-weight: 400;
         height: 30px;
         border-radius: 5px;
         border: none;
         width: 9%;
         padding-left: 35px;
         color: #fff;
         background-color: #5BC0DE;
         }
         .navbar-nav {
         float: right !important;
         }
         .navbar {
         position: relative;
         min-height: 50px;
         margin-bottom: 0px !important;
         border: 1px solid transparent;
         }
         .navbar-default .navbar-collapse, .navbar-default .navbar-form {
         border-color: #337ab7 !important;
         background-color: #337ab7 !important;
         }
         .navbar-default .navbar-nav>li>a {
         color: white;
         }
         .page-header, .navbar-brand {
         color: white !important;
         font-size: 24px;
         }
         .navbar-default .navbar-nav>.active>a, .navbar-default .navbar-nav>.active>a:focus, .navbar-default .navbar-nav>.active>a:hover {
         color: #555;
         background-color: white;
         }
         .logoHolder {
         width: 102px;
         height: 34px;
         background: url('../dist/img/Logo.png') no-repeat;
         display: inline-block;
         position: relative;
         bottom: 10px;
         }
         .loginHeaderText {
         position: relative;
         bottom: 16px;
         font-size: 20px;
         left: 10px;
         }
       
         .body1{
         background-color:lavender;
         }
         .panel-title{
         font-weight: bold;

         }
         .panel{
         border: 5px solid lavender;
		 height: 200px;
         }
         .panel-body{
         padding:10px;
         }
		 .btn-group{
		 padding-right:10px;
		 padding-left:10px;
		 }
		 
		  #linegraph{
			width:100%;
			height:300px;
		 } 
		 
		 .panel-body1{
			    display: block;
    font-size: 20px;
    overflow-x: auto;
    white-space: pre-wrap;
    white-space: -moz-pre-wrap !important;
    word-wrap: break-word;
    white-space: normal;
		 }
      </style>

   </head>
   <body>
   
   <nav class="navbar navbar-default navbar-static-top" role="navigation" style="">
            <div class="navbar-header">
               <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               </button>
               <a class="navbar-brand" href="#">
               <span class="logoHolder"></span>
               <span class="loginHeaderText">Smart Building Dashboard</span>
               </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
               <ul class="nav navbar-nav">
                  <li class="active">
                     <a href="#">Energy Consumption</a>
                  </li>
                  <li>
                     <a href="javascript:history.back()">Back to Overview</a>
                  </li>
				  
                 
			 			<form class="navbar-form navbar-right searchbox ng-pristine ng-valid" style="margin-right:0%;">
                <input class="form-control" id="search" style="width: 60%;" type="text" placeholder="Search">
                <button class="btn btn-info" id="Sbutton" onclick="searchNode()" type="button">Search</button>
                </form>
			  <li>
                     <a href="login.html">Sign Out</a>
                  </li>
               </ul>
			  
            </div>
            <!--/.nav-collapse -->
         </nav>
		
<div class="container-fluid">
	
	<div class="container-fluid">

	<div class="row" style="margin-top:1%;">
		<div class="col-md-8">
			<div class="row" >
				<div class="col-md-12">
					<div class="panel panel-default" style="height: 420px;">
						<div class="panel-heading">
							<h3 class="panel-title" id="panel_title1">
						
								
							</h3>
							<div class="col-sm-9 paginationbtn" style="margin-left: 25%;padding-bottom:0%;padding-top:2%;">
           		<button class="btn btn-info" style="float:right;margin-right:3%;margin-top:0%;" type="button"  id="totalPower">Total Power</button>
                <button class="btn btn-info" style="float:right;margin-right:1%;margin-top:0%;" type="button"  id="gasFacility">Gas Consumed</button>
                <button class="btn btn-info" style="float:right;margin-right:1%;margin-top:0%;" type="button"  id="electricityFacility">Electricity Consumed</button>
                
               
           
            </div>
								
						</div>
						<div class="panel-body">
 						<div id="linegraph" style="display:inline-block">
						  <script type="text/javascript">
						  var responsejson;
							var type;
							
				
/* #################### LINE GRAPH ################### */



$(window).load(function(){
	type =  "totalPower";
	test(type); 
     $(function(){
         $(".btn-info").on("click", function(event){
			 type = event.toElement.id;
				test(type); 
				
				
         })
     })
});

function test(type) {


 
 var type1= type;
console.log(typeof(type1));
 
  if(type1.search("Facility") > -1)
 {
 var res1 = type1.replace("Facility", " ");
 }
 else if(type1.search("total") > -1)
 {
 var res1 = type1.replace("total", " ");
 }
 else if (type1.search("Electricity") > -1)
 {
 var res1 = type1.replace("Electricity", "");
 }
 else {
 var res1 = type;
 }
 String.prototype.capitalize = function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
}
res=res1.capitalize();
 
 var a= "Total"+" "+ res + " "+ "Consumed";
 document.getElementById("panel_title1").innerHTML=a;
 
 var stack = "Last Weeks" +" "+res+ " "+"Consumption"
 document.getElementById("panel_title7").innerHTML = stack;

 var pie = "Power Consumption of each device";
 document.getElementById("panel_title8").innerHTML = pie;
 
var url = 'http://liacm218:8181/BuildingCassandraRest/getallbyscbdaily/AK/Anchorage/FullServiceRestaurant';
var response = '';
var request = new XMLHttpRequest();
request.open('GET', url, false);  // `false` makes the request synchronous
request.send(null);


$(".dropdown-menu li a").click(function(){
  
  $(".btn:first-child").html($(this).text());


});



if (request.status === 200) {
  response = request.responseText;
}
 responsejson = JSON.parse(response);

 var timestampLine= [];
	 var totalPowerLine = [];
	 var pers= 0;
	
var resultss = 0;
for(var i=0;i<12;i++){
	for (var key in responsejson[i]){
     
	 
	 
	 timestampLine[i] = new Date(responsejson[i]["timestamp"]);
	 
	if (type== "totalPower"){totalPowerLine[i] = responsejson[i][key];

	 }
	 else{
	 totalPowerLine[i] = responsejson[i][type];
	 
	
	}
	  

	 
	 }
	 
 

}	


for (i=0;i<totalPowerLine.length;i++){
	
	console.log(pers,"pers");
	pers = pers + totalPowerLine[i];
	resultss = parseInt(pers, 10); 

}

var date=[];
 
 
 for (i=0 ; i<timestampLine.length; i++){
 date[i]=(timestampLine[i].getMonth() + 1)+ "/"+timestampLine[i].getDate() + "/"   + timestampLine[i].getFullYear() }
 
 var final_data=[];
 for(i=0; i<date.length; i++)
{
    final_data.push([date[i],totalPowerLine[i]]);
	
};
 final_data.reverse();
 
   
 function rungraph(data) {
        $('#linegraph').highcharts({
            chart: {
                zoomType: 'x'
            },
            title: {
                text: 'Total' +" "+ res+" "+'consumed over time'
            },
            subtitle: {
                text: document.ontouchstart === undefined ?
                        'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
            },
           credits:{
			enabled: false
		   },
			xAxis: {
            type: 'datetime',
          
            labels: { 
                 format: '{value:%m/%d/%Y}', 
                 align: 'right', 
                 rotation: -30 ,
				 x : -5,
				 y: 10,
				 
            }, 
			gridLineWidth: 0,
  
        tickLength: 5,
        tickWidth: 1,
        tickPosition: 'outside',
        
        lineWidth:1,
      
			
               
        },
	
            yAxis: {
				gridLineWidth: 0,
   
        tickLength: 5,
        tickWidth: 1,
        tickPosition: 'outside',
        
        lineWidth:1,
     
                title: {
                    text: 'Total'+" "+res + " "+'(kWh)'
                }
            },
            legend: {
                enabled: false
            },
            plotOptions: {
		
                area: {
                    fillColor: {
                      
                         stops: [
                            [0, Highcharts.getOptions().colors[0]],
                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                        ] 
                    },
                    marker: {
                        radius: 2
                    },
                    lineWidth: 1,
                    states: {
                        hover: {
                            lineWidth: 1
                        }
                    },
                    threshold: null
                }
            },
			
			tooltip:{
			 valueDecimals: 0,
			 },
            series: [{
                type: 'area',
                name: type,
				pointStart : Date.UTC(2015,0,1),
				pointInterval: 24 * 3600 * 1000, 
                data: final_data
            }]
        });
    };
	
	rungraph(responsejson);
	
<!-- }); -->

/* #################### PIE CHART ################### */
var per = 0;
var per_value = [];
var res_num=0;
$(function () {

var header = ["null","apples"];
var data=[];

var res = responsejson[1]


var xvalue = []
for (var key in res){
    
	 if (key == "state" || key == "city" || key == "buildingtype" || key == "totalPower" || key == "timestamp" || key == "gasFacility" || key == "electricityFacility" ){continue;}
	 
	 else { 
	
	 data.push({"name":key,"y":res[key]});
	 
	 
	 per = per + res[key];
	 res_num = parseInt(pers, 10); 
	 
	 }
		
	 
	 }
	 
	  console.log(per, "per"); 
	 data.sort(function(a, b) {
	
    return parseFloat(b.y) - parseFloat(a.y);
});

console.log(per_value,"per_value"); 
	 



    $('#pie').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'column'
			
        },
        title: {
                  
				text:'Total:'+res_num,
				valueDecimals: 2,
			 align: 'right',
			
            },
      
		credits:{
			enabled: false
		   },
		   tooltip: {
             valueDecimals: 0,
        },
		  xAxis: {
            categories : [],
			labels: { 
                 
                 align: 'right', 
                 rotation: -30 ,
				 x : -5,
				 y: 10,
				 
            }, 

           
        },
		legend: {
                enabled: false
            },
		yAxis: {
			gridLineWidth: 0,

        tickLength: 5,
        tickWidth: 1,
        tickPosition: 'outside',
        
        lineWidth:1,
      title: {
                    text: 'Energy Consumed(kWh)'
                }
		
		
		
		},
        plotOptions: {
            series: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
					align: 'right',
                    color: 'black',
                    y: 1,
					formatter: function () {
					 var pcnt = (this.y / per) * 100;
					 return  Highcharts.numberFormat(this.y,0)+" ("+Highcharts.numberFormat(pcnt,0) + "%)" ; 
        
    },
					 
                },
				pointPadding: 0.1,
                groupPadding: 0,
				overflow:false,
				
				showInLegend: true
            }
        },
		
        series: [{
            name: 'Total Power',
            colorByPoint: true,
			    point:{
                  events:{
                      click: function (event) {
							<!-- alert(this.name); -->
                          test(this.name);
                      }
                  }
              }  ,
            data: data
        }]
    });
	
});
/* #################### STACKED BAR CHART ################### */

var per = [];
var today = new Date(timestampLine[0]);
var year = today.getFullYear();
var month = today.getMonth();
var date = today.getDate();

if (date < 7){
month = today.getMonth() - 1 ;
}

if (month <1 && date < 7){
month = 12
year = today.getFullYear()-1;

}
    var lastWeek = new Date(year, month, date - 7);
 var date = []
 
 for (i = 0; i < 7; i++) { 
    date[i] = new Date(lastWeek.getFullYear(), lastWeek.getMonth(), lastWeek.getDate() + i);
}

 

var final_date = [];
 for (i = 0; i < 7; i++) { 
final_date[i]= (date[i].getMonth() + 1)+ "/"+date[i].getDate()  +  "/" + date[1].getFullYear();

}
final_date.reverse(); 
var rows = [];
for(i=0; i<7; i++)
{
    rows.push([final_date[i],totalPowerLine[i+1]]);
}
var data="john"


$('#bar').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: ''
        },
        xAxis: {
		gridLineWidth: 0,
  
        tickLength: 5,
        tickWidth: 1,
        tickPosition: 'outside',
        labels: {
            align: 'right',
            x:-10,
            y:5
        },
        lineWidth:1,
   
            categories: [],
			
        },
		 title: {
                  
				text:'Total:'+resultss,
				valueDecimals: 2,
			 align: 'right',
			
            },
        yAxis: {
            min: 0,
			tickInterval: 200,
           
			title:{text:''},
			gridLineWidth: 0,
 
        tickLength: 5,
        tickWidth: 1,
        tickPosition: 'outside',
        labels: {
            align: 'right',
            x:0,
            y:10
        },
        lineWidth:1,
      
	  showInLegend: true
        },
		credits:{
			enabled: false
		   },
		    tooltip: {
            valueDecimals: 0,},
       
        plotOptions: {
           	 series: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
					align: 'right',
                    color: 'black',
                    y: 1,
					formatter: function () {
					var pcnt = (this.y / pers) * 100;
        return Highcharts.numberFormat(this.y,0)+" ("+Highcharts.numberFormat(pcnt,0) + "%)";
    },
	
                },
				
				pointPadding: 0.1,
                groupPadding: 0,
				overflow:false,
				<!-- stacking:normal, -->
				point: {
                    events: {
                        click: function () {
                            <!-- alert('Category: ' + this.name+ ', value: ' + this.y); -->
                        }
                    }
                }
				},
        },
      series: [{
            name: 'Total Power',
            data: rows
        }]
    });
	
/*#####################GAUGE#######################*/
	
	var result = responsejson[1]
	
	
	  var data = [];
	  var res1=" ";
	  var res= [];
	  res.push([type]);
	  data = result[type];
	
var final_data = [];
	
	final_data.push([data]);
$('#gauge').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: ''
        },
        xAxis: {
		gridLineWidth: 0,
   
        tickLength: 5,
        tickWidth: 1,
        tickPosition: 'outside',
        labels: {
            align: 'right',
            x:-10,
            y:5
        },
        lineWidth:1,
      
            categories: res1,
			
        },
        yAxis: {
		
            min: 0,
			tickInterval: 100,
            title: {
                text:'' <!-- 'Total'+ " "+type+ " "+'Consumption' -->
            },
			
			gridLineWidth: 0,
   
        tickLength: 5,
        tickWidth: 1,
        tickPosition: 'outside',
        labels: {
            align: 'right',
            x:0,
            y:10
        },
        lineWidth:1,
      
	  showInLegend: true
        },
		credits:{
			enabled: false
		   },
		    tooltip: {
            valueDecimals: 0,},
       
        plotOptions: {
           	 series: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
					align: 'right',
                    color: 'black',
                    y: 1,
					formatter: function () {
					
        return Highcharts.numberFormat(this.y,0);
    },
	
                },
				
				pointPadding: 0.01,
                groupPadding: 0,
				overflow:false,
				
				point: {
                    events: {
                        click: function () {
                            <!-- alert('Category: ' + this.name+ ', value: ' + this.y); -->
                        }
                    }
                }
				},
        },
      series: [{
            name: 'Total Power',
            data: final_data
        }]
    });
	
	
	
	



};
		</script> 
						  
						  </div>
							
						</div>
						
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="panel panel-default" style="height:260px;">
				<div class="panel-heading">
					<h3 class="panel-title" id = "panel_title2" >
						Relative Usage
					</h3>
				</div>
				<div class="panel-body">
				
					  <div id="gauge" style="display:inline-block;width: 100%; height: 200px;"></div>

    
                    </div> 
				</div>
				
			
			<div class="row">
				<div class="col-md-6">
					<div class="panel panel-default"  style="font-size:15px;height: 140px; text-align:"centre";>
						<div class="panel-heading">
							<h3 class="panel-title" id = "panel_title3" >
								Average Use 
							</h3>
						</div>
						<div class="panel-body panel-body1" style="display:inline-block; ">
							Avg. Daily Users(weekday)
							<script>
								<!-- var avg = Math.floor(Math.random() * 201) - 100; -->
								var avg="177"; 
								
								<!-- var res = avg.toString(); -->
								 var res= avg.fontsize(6);  
								var result = res.bold(); 
								document.write(result);
								
							</script>
						</div>
						
					</div>
				</div>
				<div class="col-md-6">
					<div class="panel panel-default" style="font-size:20px;height: 140px;">
						<div class="panel-heading">
							<h3 class="panel-title" id = "panel_title4" >
								Predicted Usage
							</h3>
						</div>
						<div class="panel-body panel-body1" style="display:inline-block;" >
							Total Gas Consumed (Approx):
							<script>
								var avg="100";
								var res= avg.fontsize(6);
								var result = res.bold(); 
								document.write(result);
							</script>
						</div>
						
					</div>
				</div>
			</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<div class="row">
				<div class="col-md-2">
					<div class="row">
						<div class="col-md-12">
							<div class="panel panel-default"  style="height: 179px;">
								<div class="panel-heading">
									<h3 class="panel-title" id = "panel_title5" >
										Predicted Usage
									</h3>
								</div>
								<div class="panel-body panel-body1" style="display:inline-block; ">
								
									Energy Consumed by Devices(Gas Energy):           
							<script>
								var avg="156";
								var res= avg.fontsize(6);
								var result = res.bold(); 
								document.write(result);
							</script>
								</div>
								
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<div class="panel panel-default" style="height: 179px;">
								<div class="panel-heading">
									<h3 class="panel-title" id = "panel_title6" >
										Predicted Usage
									</h3>
								</div>
								<div class="panel-body panel-body1" style="display:inline-block;">
									Energy Consumed by Devices(Electricity):
							<script>
								var avg="438";
								var res= avg.fontsize(6);
								var result = res.bold(); 
								document.write(result);
							</script>
								</div>
								
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div class="panel panel-default" style="height: 380px;">
						<div class="panel-heading">
							<h3 class="panel-title" id = "panel_title7" >
								Stacked bar
							</h3>
						</div>
						<div class="panel-body">
						<div id="bar" style="display:inline-block;width: 100%; height: 310px;"></div>
									
						</div>
						
					</div>
				</div>
				<div class="col-md-4">
					<div class="panel panel-default" style="height: 380px;">
						<div class="panel-heading">
							<h3 class="panel-title" id = "panel_title8" >
								Pie Chart
							</h3>
						</div>
						<div class="panel-body">
							 <div id="pie" style="display:inline-block;width: 100%; height: 310px;"></div>
							 		
						</div>
						
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
 <div class="col-lg-12" style="background: #337ab7;">
        <footer>
  <p style="float: right;margin-top: 0.5%;"><b>Powered By EMC VSD Bangalore</b></p>
</footer>
        </div>
</div>
   <!-- <script src="../bower_components/jquery/dist/jquery.min.js"></script> -->
      <!-- Bootstrap Core JavaScript -->
      <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
      <!-- Metis Menu Plugin JavaScript -->
      <script src="../bower_components/metisMenu/dist/metisMenu.min.js"></script>
      <!-- Custom Theme JavaScript -->
      <script src="../dist/js/sb-admin-2.js"></script>
      <script src="stockJs.js"></script>
      <!-- <script src="Highstock-2.1.9/js/highstock.js"></script> -->
      <!-- <script src="Highstock-2.1.9/js/modules/exporting.js"></script> -->
      <!-- <script src="Highstock-2.1.9/js/themes/sand-signika.js"></script> -->
	  <!-- <script src="https://code.highcharts.com/highcharts.js"></script>
	  <script src="https://code.highcharts.com/modules/exporting.js"></script> -->
	  <!-- <script src="http://code.highcharts.com/highcharts-more.js"></script>  -->
	  <!-- <script src="https://code.highcharts.com/modules/solid-gauge.js"></script> -->
	   
	  

   </body>
</html>